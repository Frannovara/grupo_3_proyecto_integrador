<!DOCTYPE html>
<html lang="en">
    <%- include('../partials/head.ejs') %>
<body>
    <div class="body-content">
        <%- include('../partials/header') %>
        <main class="profile">
            <div class="div-profile-image">
                <img class="profile-image" src="<%= locals.user.profile_image %> " alt="<%= locals.user.first_name %> <%= locals.user.last_name %> ">           
                <button onclick="document.getElementById('profile-image-form').style.display='block'" class="boton-form" data-toggle="modal" data-target="#profile-image-form">
                    <small>Cambiar imagen de perfil</small>
                </button>
            </div>
            <div class="profile-user-data">
                <h1>Perfil de <%= locals.user.first_name %> <%= locals.user.last_name %> </h1>
                <p>Nombre: <%= locals.user.first_name %> </p>
                <p>Apellido: <%= locals.user.last_name %> </p>
                <p>Email: <%= locals.user.email %> </p>
                <button onclick="document.getElementById('edit-user-form').style.display='block'" class="boton-form" data-toggle="modal" data-target="#profile-image-form">
                    Editar datos de Usuario
                </button>
                <button onclick="document.getElementById('change-password-form').style.display='block'" class="boton-form" data-toggle="modal" data-target="#profile-image-form">
                    Cambiar contraseña
                </button>
                <button onclick="document.getElementById('delete-user-form').style.display='block'" class="boton-form" data-toggle="modal" data-target="#delete-user-form">
                    Eliminar Usuario
                </button>
            </div>
            <div id="profile-image-form" class="modal">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3 class="modal-titulo">Editar foto de perfil</h3>
                        <span class="close" onclick="document.getElementById('profile-image-form').style.display='none'">&times;</span>
                    </div>
                    <div class="modal-content-info">
                        <h3>Seleccionar la nueva imagen de perfil</h3>
                        <form action="/users/profileImage/?_method=PUT" method="POST" enctype="multipart/form-data">
                            <div class="create-form-element">
                                <input type="file" name="image" id="image" required>
                            </div>
                            <button type="submit" class="register-form-button">Subir imagen</button>
                        </form>
                    </div>
                    
                </div>
            </div>
            
            

            <div id="edit-user-form" class="modal" 
            <% if (typeof errors != 'undefined') { %>
                style= "display:block"
                <% } %>
                >
                <div class="modal-content">
                    <div class="edit-user-content">
                        <div class="modal-header">
                            <h3 class="modal-titulo">Editar datos de Usuario</h3>
                            <span class="close" onclick="document.getElementById('edit-user-form').style.display='none'">&times;</span>
                        </div>
                        <form class="edit-user-form" action="/users/profile/<%= locals.user.id %> /?_method=PUT" method="POST">
                            <div class="register-form-fields">
                                <div class="div-campo-datos">
                                    <label for="name">Nombre</label>
                                    <div class="campo-datos">
                                        <i class="fas fa-user"></i>
                                        <input type="text" name="first_name" id="first_name" class="campo-datos-type"
                                            value="<%= user.first_name %>">
                                    </div>
                                    <div class="register-errors">
                                        <p>
                                            <% if (typeof errors != 'undefined') { %>
                                                <%=typeof errors.first_name != 'undefined' ?  errors.first_name.msg : ''%>
                                            <% } %>
                                        </p>
                                    </div>
                                </div>
                                <div class="div-campo-datos">
                                    <label for="name">Apellido</label>
                                    <div class="campo-datos">
                                        <i class="fas fa-user"></i>
                                        <input type="text" name="last_name" id="last_name" class="campo-datos-type"
                                            value="<%= user.last_name %>">
                                    </div>
                                    <div class="register-errors">
                                        <p>
                                            <% if (typeof errors != 'undefined') { %>
                                                <%=typeof errors.last_name != 'undefined' ?  errors.last_name.msg : ''%>
                                                <% } %>
                                        </p>
                                    </div>
                                </div>
                                <div class="div-campo-datos">
                                    <label for="email">E-mail</label>
                                    <div class="campo-datos">
                                        <i class="fas fa-envelope"></i>
                                        <input type="email" name="email" id="email" class="campo-datos-type"
                                            value="<%= user.email %>">
                                    </div>
                                    <div class="register-errors">
                                        <p>
                                            <% if (typeof errors != 'undefined') { %>
                                                <%=typeof errors.email != 'undefined' ?  errors.email.msg : ''%>
                                                <% } %>
                                        </p>
                                    </div>
                                </div>
                            </div>
                            <button type="submit" class="register-form-button">Editar Datos</button>
                        </form>
                    </div>
                </div>
            </div>
            <div id="change-password-form" class="modal" 
            <% if (typeof password_errors != 'undefined') { %>
                style= "display:block"
                <% } %>
                >
                <div class="modal-content">
                    <div class="edit-user-content">
                        <div class="modal-header">
                            <h3 class="modal-titulo">Cambiar la contraseña</h3>
                            <span class="close" onclick="document.getElementById('change-password-form').style.display='none'">&times;</span>
                        </div>
                        <form class="edit-user-form" action="/users/newpassword/?_method=PUT" method="POST">
                            <div class="register-form-fields">                        
                                <div class="div-campo-datos">
                                    <label for="password">Contraseña</label>
                                    <div class="campo-datos">
                                        <i class="fas fa-lock"></i>
                                        <input type="password" name="password" id="password" class="campo-datos-type">
                                    </div>
                                    <div class="register-errors">
                                        <p>
                                            <% if (typeof password_errors != 'undefined') { %>
                                                <%=typeof password_errors.password != 'undefined' ?  password_errors.password.msg : ''%>
                                                <% } %>
                                            
                                        </p>
                                    </div>
                                </div>
                                <div class="div-campo-datos">
                                    <label for="re-password">Repita la contraseña</label>
                                    <div class="campo-datos">
                                        <i class="fas fa-lock"></i>
                                        <input type="password" name="re_password" id="re_password" class="campo-datos-type">
                                    </div>
                                    <div class="register-errors">
                                        <p>
                                            <% if (typeof password_errors != 'undefined') { %>
                                                <%=typeof password_errors.re_password != 'undefined' ?  password_errors.re_password.msg : ''%>
                                                <% } %>
                                            
                                        </p>
                                    </div>
                                </div>
                            </div>
                            <button type="submit" class="register-form-button">Confirmar</button>
                        </form>
                    </div>
                </div>
            </div>

            <div id="delete-user-form" class="modal">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3 class="modal-titulo">¿Estás seguro de que quieres eliminar el Usuario?</h3>
                        <span class="close" onclick="document.getElementById('delete-user-form').style.display='none'">&times;</span>
                    </div>
                    <div class="modal-content-info">
                        <% if (locals.user.category_id == 1) { %>
                            <p class="modal-text">Lo sentimos, pero no es posible eliminar el usuario administrador</p>
                        <% } else { %>
                            <p class="modal-text">Al eliminar tu usuario puedes regresar cuando quieras, y volver a iniciar sesión, no es necesario registrarse.</p>
                            <form action="/users/delete/<%= locals.user.id %> /?_method=DELETE" method="POST">
                                <button type="submit" class="register-form-button">Eliminar Usuario</button>
                            </form>
                        <% } %>
                    </div>
                    
                </div>
            </div>
        </main>
    </div>
    <%- include('../partials/footer') %>
</body>
</html>